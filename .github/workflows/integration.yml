name: Integration Test
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:

      - uses: actions/checkout@main

      - name: Install yq
        id: get_chart_version
        run: |
          sudo wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
          sudo chmod +x /usr/local/bin/yq
          cd $GITHUB_WORKSPACE
          echo cat values.yaml | yq -r '.authelia.chartVersion' > message.txt
          echo "::set-output name=chart-version::$(cat values.yaml | yq -r '.authelia.chartVersion')"
          cat message.txt

      - name: test for pending updates

        # Put your action repo here
        uses: loeken/homelab-updater@main
        with:
          github_user: authelia
          github_repo: chartrepo
          github_token: ${{ secrets.UPDATE_TOKEN }}
          release: ${{ steps.get_chart_version.outputs.chart-version }}
          chart_name: authelia
          release_remove_string: authelia-
